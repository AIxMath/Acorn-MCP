<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acorn MCP - Monochrome Knowledge Base</title>
    <style>
        :root {
            --bg: #050505;
            --panel: #0c0c0c;
            --border: #1f1f1f;
            --text: #f5f5f5;
            --muted: #9b9b9b;
            --code: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        a { color: inherit; text-decoration: none; }
        a:hover { text-decoration: underline; }

        .page { max-width: 1200px; margin: 0 auto; padding: 24px 20px 64px; }

        .top-bar {
            position: sticky;
            top: 0;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            padding: 14px 0;
            background: rgba(5, 5, 5, 0.92);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--border);
        }

        .brand { font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase; }

        .nav-links { display: flex; gap: 14px; align-items: center; flex-wrap: wrap; }

        .pill {
            border: 1px solid var(--border);
            border-radius: 999px;
            padding: 8px 12px;
            font-size: 0.9em;
            background: #0b0b0b;
            transition: border-color 0.2s ease, color 0.2s ease;
        }
        .pill:hover { border-color: var(--text); color: var(--text); text-decoration: none; }

        .hero { padding: 36px 0 24px; display: flex; flex-direction: column; gap: 12px; border-bottom: 1px solid var(--border); }
        .eyebrow { text-transform: uppercase; letter-spacing: 1px; color: var(--muted); font-size: 0.8em; }
        .hero h1 { font-size: 2.6em; letter-spacing: -0.5px; }
        .lede { color: #c8c8c8; max-width: 760px; }

        .cta-row { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 4px; }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 18px; border-radius: 10px; border: 1px solid var(--border); font-weight: 600; }
        .btn.primary { background: #ffffff; color: #000000; border-color: #ffffff; }
        .btn.ghost { background: transparent; color: var(--text); }
        .btn:hover { text-decoration: none; border-color: #ffffff; }

        .quick-links { display: flex; gap: 10px; flex-wrap: wrap; color: var(--muted); font-size: 0.95em; }

        .link-board { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; margin: 24px 0 32px; }
        .link-card { background: var(--panel); border: 1px solid var(--border); padding: 18px; border-radius: 12px; min-height: 150px; display: flex; flex-direction: column; gap: 10px; }
        .chip-row { display: flex; gap: 10px; flex-wrap: wrap; }
        .chip { border: 1px solid var(--border); border-radius: 999px; padding: 8px 12px; font-size: 0.9em; background: #0f0f0f; }
        .muted { color: var(--muted); }

        .section { margin: 32px 0; }
        .section-head { display: flex; justify-content: space-between; align-items: flex-end; gap: 12px; flex-wrap: wrap; }
        .section h2 { margin-top: 4px; }
        .meta { color: var(--muted); font-size: 0.95em; }

        .panel-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 18px; margin-top: 18px; }
        .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 18px; display: flex; flex-direction: column; gap: 12px; }
        .panel-title { display: flex; justify-content: space-between; align-items: center; gap: 8px; font-weight: 600; }

        form .form-group { display: flex; flex-direction: column; gap: 6px; }
        label { font-weight: 600; }
        input, textarea {
            background: #050505;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 11px 12px;
            color: var(--text);
            font-size: 1em;
            font-family: inherit;
        }
        textarea { min-height: 120px; resize: vertical; }
        input:focus, textarea:focus { outline: none; border-color: #ffffff; }
        button { cursor: pointer; }

        .message { padding: 10px 12px; border-radius: 10px; border: 1px solid; display: none; }
        .message.success { border-color: #2e2e2e; background: #0a0a0a; color: #cbe7cb; }
        .message.error { border-color: #3a1a1a; background: #130707; color: #f5a4a4; }
        .message.show { display: block; }

        .stack { display: flex; flex-direction: column; gap: 12px; }
        .item { border: 1px solid var(--border); border-radius: 10px; padding: 14px; background: #0a0a0a; display: flex; flex-direction: column; gap: 10px; }
        .item-header { display: flex; justify-content: space-between; gap: 10px; flex-wrap: wrap; }
        .item-title { font-size: 1.1em; font-weight: 700; }
        .badge { border: 1px solid var(--border); border-radius: 999px; padding: 6px 10px; font-size: 0.85em; color: #c8c8c8; }
        .code-block { background: #050505; border: 1px solid var(--border); border-radius: 8px; padding: 10px; }
        .code-label { text-transform: uppercase; letter-spacing: 0.5px; color: #aaaaaa; font-size: 0.75em; margin-bottom: 6px; }
        pre { margin: 0; white-space: pre-wrap; font-family: "SFMono-Regular", Consolas, "Liberation Mono", monospace; color: var(--code); line-height: 1.5; }

        .pagination { display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; border-top: 1px solid var(--border); padding-top: 10px; }
        .pager-controls { display: flex; gap: 8px; }
        .pagination button { background: #ffffff; color: #000000; border: 1px solid #ffffff; border-radius: 8px; padding: 8px 12px; font-weight: 600; }
        .pagination button.secondary { background: transparent; color: var(--text); border-color: var(--border); }
        .pagination button:disabled { opacity: 0.35; cursor: not-allowed; }
        .page-stats { color: var(--muted); font-size: 0.95em; }

        .empty-state, .loading { color: var(--muted); text-align: center; padding: 16px 0; border: 1px dashed var(--border); border-radius: 10px; background: #080808; }

        .search-row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        .search-row input { flex: 1; min-width: 240px; }
        .search-row button { height: 42px; }

        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; flex-wrap: wrap; gap: 12px; color: var(--muted); }

        @media (max-width: 640px) { .top-bar { position: static; } }
    </style>
</head>
<body>
    <div class="page">
        <nav class="top-bar" id="home">
            <div class="brand">Acorn MCP</div>
            <div class="nav-links">
                <a class="pill" href="#home">Home</a>
                <a class="pill" href="#create">Create</a>
                <a class="pill" href="#browse-theorems">Find Theorems</a>
                <a class="pill" href="#browse-definitions">Find Definitions</a>
                <a class="pill" href="#library">Library</a>
            </div>
            <div class="nav-links">
                <a class="pill" href="/api/theorems?page=1&page_size=20">API: theorems</a>
                <a class="pill" href="/api/definitions?page=1&page_size=20">API: definitions</a>
            </div>
        </nav>

        <header class="hero">
            <div class="eyebrow">Monochrome knowledge base</div>
            <h1>Structured theorems & definitions</h1>
            <p class="lede">Separated create/browse flows keep things fast. Search across names, heads, raw text, and proofs while keeping formal blocks readable.</p>
            <div class="cta-row">
                <a class="btn primary" href="#create">Add entries</a>
                <a class="btn ghost" href="#browse-theorems">Browse & search</a>
            </div>
            <div class="quick-links">
                <a href="#theorem-form">Add theorem</a>
                <span>•</span>
                <a href="#definition-form">Add definition</a>
                <span>•</span>
                <a href="#browse-theorems">Search theorems</a>
                <span>•</span>
                <a href="#browse-definitions">Search definitions</a>
            </div>
        </header>

        <section class="link-board">
            <div class="link-card">
                <h3>API endpoints</h3>
                <p class="muted">Use the JSON feeds with `page`, `page_size`, and optional `q` to filter.</p>
                <div class="chip-row">
                    <a class="chip" href="/api/theorems?page=1&page_size=20">/api/theorems</a>
                    <a class="chip" href="/api/definitions?page=1&page_size=20">/api/definitions</a>
                </div>
            </div>
            <div class="link-card">
                <h3>Render hints</h3>
                <p class="muted">Proofs, heads, and raw text are rendered in monospace blocks with preserved line breaks.</p>
                <div class="chip-row">
                    <span class="chip">Black/white palette</span>
                    <span class="chip">Paginated lists</span>
                    <span class="chip">Search utilities</span>
                </div>
            </div>
            <div class="link-card">
                <h3>Library</h3>
                <p class="muted">Vendored Acorn library ships alongside this app; import it when you need raw sources.</p>
                <div class="chip-row">
                    <a class="chip" href="#library">Explore library pointers</a>
                    <a class="chip" href="/static">Static assets</a>
                </div>
            </div>
        </section>

        <section id="create" class="section">
            <div class="section-head">
                <div>
                    <div class="eyebrow">Create</div>
                    <h2>Isolated insert forms</h2>
                    <div class="meta">Add entries without loading the browse lists. Heads accept free variables; include the raw source alongside the proof.</div>
                </div>
            </div>
            <div class="panel-grid">
                <div class="panel" id="theorem-form">
                    <div class="panel-title">
                        <span>Add a theorem</span>
                        <span class="muted">Formal head + proof + raw</span>
                    </div>
                    <div id="theorem-message" class="message"></div>
                    <form id="theorem-form-inner">
                        <div class="form-group">
                            <label for="theorem-name">Name</label>
                            <input type="text" id="theorem-name" required placeholder="e.g., Monotonicity of >">
                        </div>
                        <div class="form-group">
                            <label for="theorem-head">Head (with free variables)</label>
                            <textarea id="theorem-head" required placeholder="theorem greater_than(x: Int) { x > 3 implies x > 2 }"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="theorem-proof">Proof</label>
                            <textarea id="theorem-proof" required placeholder="Proof text; formatting is preserved"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="theorem-raw">Raw source</label>
                            <textarea id="theorem-raw" required placeholder="Raw theorem text with free variables or additional context"></textarea>
                        </div>
                        <button type="submit" class="btn primary">Add theorem</button>
                    </form>
                </div>

                <div class="panel" id="definition-form">
                    <div class="panel-title">
                        <span>Add a definition</span>
                        <span class="muted">Monospace-friendly</span>
                    </div>
                    <div id="definition-message" class="message"></div>
                    <form id="definition-form-inner">
                        <div class="form-group">
                            <label for="definition-name">Name</label>
                            <input type="text" id="definition-name" required placeholder="e.g., Prime Number">
                        </div>
                        <div class="form-group">
                            <label for="definition-text">Definition</label>
                            <textarea id="definition-text" required placeholder="Formal definition text"></textarea>
                        </div>
                        <button type="submit" class="btn primary">Add definition</button>
                    </form>
                </div>
            </div>
        </section>

        <section id="browse-theorems" class="section">
            <div class="section-head">
                <div>
                    <div class="eyebrow">Find</div>
                    <h2>Browse theorems</h2>
                    <div class="meta">Search by name, head, raw text, or proof. Paginated for performance.</div>
                </div>
                <div id="theorem-summary" class="meta">Loading…</div>
            </div>
            <div class="panel">
                <div class="panel-title">
                    <span>Search & results</span>
                    <span class="muted" id="theorem-count">Loading…</span>
                </div>
                <form id="theorem-search-form" class="search-row">
                    <input type="search" id="theorem-search" placeholder="Search theorems (name, head, raw, proof)">
                    <button type="submit" class="btn primary">Search</button>
                    <button type="button" id="theorem-clear" class="btn ghost">Clear</button>
                </form>
                <div id="theorems-list" class="stack"></div>
                <div class="pagination" id="theorem-pagination">
                    <div class="pager-controls">
                        <button class="secondary prev" type="button">Previous</button>
                        <button class="next" type="button">Next</button>
                    </div>
                    <div class="page-stats">Loading…</div>
                </div>
            </div>
        </section>

        <section id="browse-definitions" class="section">
            <div class="section-head">
                <div>
                    <div class="eyebrow">Find</div>
                    <h2>Browse definitions</h2>
                    <div class="meta">Search by name or definition text. Paginated for performance.</div>
                </div>
                <div id="definition-summary" class="meta">Loading…</div>
            </div>
            <div class="panel">
                <div class="panel-title">
                    <span>Search & results</span>
                    <span class="muted" id="definition-count">Loading…</span>
                </div>
                <form id="definition-search-form" class="search-row">
                    <input type="search" id="definition-search" placeholder="Search definitions (name, text)">
                    <button type="submit" class="btn primary">Search</button>
                    <button type="button" id="definition-clear" class="btn ghost">Clear</button>
                </form>
                <div id="definitions-list" class="stack"></div>
                <div class="pagination" id="definition-pagination">
                    <div class="pager-controls">
                        <button class="secondary prev" type="button">Previous</button>
                        <button class="next" type="button">Next</button>
                    </div>
                    <div class="page-stats">Loading…</div>
                </div>
            </div>
        </section>

        <section id="library" class="section">
            <div class="section-head">
                <div>
                    <div class="eyebrow">Library</div>
                    <h2>What else lives here</h2>
                    <div class="meta">Acorn sources, import helpers, and raw static assets for exploration.</div>
                </div>
            </div>
            <div class="link-board">
                <div class="link-card">
                    <h3>acornlib/</h3>
                    <p class="muted">Vendored Acorn standard library. Keep it pristine; import it via scripts when needed.</p>
                    <div class="chip-row">
                        <span class="chip">Read-only corpus</span>
                        <a class="chip" href="/static">Static folder</a>
                    </div>
                </div>
                <div class="link-card">
                    <h3>Maintenance</h3>
                    <p class="muted">Use <code>python -m scripts.import_acornlib</code> to bulk-import when refreshing data.</p>
                    <div class="chip-row">
                        <span class="chip">CLI friendly</span>
                        <span class="chip">Async API</span>
                    </div>
                </div>
            </div>
        </section>

        <div class="footer">
            <span>Black and white UI for focused reading.</span>
            <a href="#home">Back to top</a>
        </div>
    </div>

    <script>
        const state = {
            theorems: { page: 1, pageSize: 20, total: 0, pages: 1, query: '' },
            definitions: { page: 1, pageSize: 20, total: 0, pages: 1, query: '' }
        };

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showMessage(elementId, message, isError = false) {
            const messageEl = document.getElementById(elementId);
            messageEl.textContent = message;
            messageEl.className = 'message show ' + (isError ? 'error' : 'success');
            setTimeout(() => messageEl.classList.remove('show'), 5000);
        }

        function setListLoading(elementId) {
            const el = document.getElementById(elementId);
            el.innerHTML = '<div class="loading">Loading…</div>';
        }

        function formatDate(value) {
            if (!value) return '';
            return new Date(value).toLocaleString();
        }

        function renderPagination(kind, meta) {
            const pagination = document.getElementById(`${kind}-pagination`);
            if (!pagination) return;

            const prevBtn = pagination.querySelector('.prev');
            const nextBtn = pagination.querySelector('.next');
            const stats = pagination.querySelector('.page-stats');
            const totalPages = Math.max(1, meta.pages || 1);
            const currentPage = Math.max(1, meta.page || 1);
            const filterNote = meta.query ? ' (filtered)' : '';

            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
            stats.textContent = `${meta.total || 0} total${filterNote} · page ${currentPage} / ${totalPages}`;

            if (kind === 'theorem') {
                prevBtn.onclick = () => loadTheorems(currentPage - 1);
                nextBtn.onclick = () => loadTheorems(currentPage + 1);
            } else {
                prevBtn.onclick = () => loadDefinitions(currentPage - 1);
                nextBtn.onclick = () => loadDefinitions(currentPage + 1);
            }
        }

        async function loadTheorems(page = state.theorems.page) {
            state.theorems.page = page;
            setListLoading('theorems-list');
            try {
                const query = state.theorems.query;
                const queryParam = query ? `&q=${encodeURIComponent(query)}` : '';
                const response = await fetch(`/api/theorems?page=${page}&page_size=${state.theorems.pageSize}${queryParam}`);
                const data = await response.json();
                state.theorems.total = data.total;
                state.theorems.pages = data.pages;
                state.theorems.query = data.query ?? query ?? '';
                renderTheoremList(data);
            } catch (error) {
                console.error('Error loading theorems:', error);
                document.getElementById('theorems-list').innerHTML = '<div class="empty-state">Error loading theorems. Please try again.</div>';
                renderPagination('theorem', { page: 1, pages: 1, total: 0, query: state.theorems.query });
            }
        }

        async function loadDefinitions(page = state.definitions.page) {
            state.definitions.page = page;
            setListLoading('definitions-list');
            try {
                const query = state.definitions.query;
                const queryParam = query ? `&q=${encodeURIComponent(query)}` : '';
                const response = await fetch(`/api/definitions?page=${page}&page_size=${state.definitions.pageSize}${queryParam}`);
                const data = await response.json();
                state.definitions.total = data.total;
                state.definitions.pages = data.pages;
                state.definitions.query = data.query ?? query ?? '';
                renderDefinitionList(data);
            } catch (error) {
                console.error('Error loading definitions:', error);
                document.getElementById('definitions-list').innerHTML = '<div class="empty-state">Error loading definitions. Please try again.</div>';
                renderPagination('definition', { page: 1, pages: 1, total: 0, query: state.definitions.query });
            }
        }

        function renderTheoremList(data) {
            const listEl = document.getElementById('theorems-list');
            const summary = document.getElementById('theorem-summary');
            const count = document.getElementById('theorem-count');
            const query = data.query ?? state.theorems.query ?? '';

            if (!data.theorems || data.theorems.length === 0) {
                listEl.innerHTML = '<div class="empty-state">No theorems yet. Add your first entry to begin.</div>';
            } else {
                listEl.innerHTML = data.theorems.map(theorem => `
                    <div class="item">
                        <div class="item-header">
                            <div>
                                <div class="item-title">${escapeHtml(theorem.name)}</div>
                                <div class="meta">Added ${formatDate(theorem.created_at)}</div>
                            </div>
                            <span class="badge">Theorem</span>
                        </div>
                        <div class="code-block">
                            <div class="code-label">Head (with free variables)</div>
                            <pre>${escapeHtml(theorem.theorem_head)}</pre>
                        </div>
                        <div class="code-block">
                            <div class="code-label">Proof</div>
                            <pre>${escapeHtml(theorem.proof)}</pre>
                        </div>
                        <div class="code-block">
                            <div class="code-label">Raw</div>
                            <pre>${escapeHtml(theorem.raw || '')}</pre>
                        </div>
                    </div>
                `).join('');
            }

            const filterNote = query ? ` (filtered by "${query}")` : '';
            const summaryText = data.total ? `${data.total} total${filterNote} · page ${data.page} of ${data.pages}` : 'No theorems yet';
            summary.textContent = summaryText;
            count.textContent = summaryText;
            renderPagination('theorem', { ...data, query });
        }

        function renderDefinitionList(data) {
            const listEl = document.getElementById('definitions-list');
            const summary = document.getElementById('definition-summary');
            const count = document.getElementById('definition-count');
            const query = data.query ?? state.definitions.query ?? '';

            if (!data.definitions || data.definitions.length === 0) {
                listEl.innerHTML = '<div class="empty-state">No definitions yet. Capture one to get started.</div>';
            } else {
                listEl.innerHTML = data.definitions.map(definition => `
                    <div class="item">
                        <div class="item-header">
                            <div>
                                <div class="item-title">${escapeHtml(definition.name)}</div>
                                <div class="meta">Added ${formatDate(definition.created_at)}</div>
                            </div>
                            <span class="badge">Definition</span>
                        </div>
                        <div class="code-block">
                            <div class="code-label">Definition</div>
                            <pre>${escapeHtml(definition.definition)}</pre>
                        </div>
                    </div>
                `).join('');
            }

            const filterNote = query ? ` (filtered by "${query}")` : '';
            const summaryText = data.total ? `${data.total} total${filterNote} · page ${data.page} of ${data.pages}` : 'No definitions yet';
            summary.textContent = summaryText;
            count.textContent = summaryText;
            renderPagination('definition', { ...data, query });
        }

        document.getElementById('theorem-form-inner').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('theorem-name').value;
            const theoremHead = document.getElementById('theorem-head').value;
            const proof = document.getElementById('theorem-proof').value;
            const raw = document.getElementById('theorem-raw').value;

            try {
                const response = await fetch('/api/theorems', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, theorem_head: theoremHead, proof, raw })
                });

                if (response.ok) {
                    showMessage('theorem-message', 'Theorem added successfully!');
                    document.getElementById('theorem-form-inner').reset();
                    loadTheorems(1);
                } else {
                    const error = await response.json();
                    showMessage('theorem-message', error.detail || 'Error adding theorem', true);
                }
            } catch (error) {
                showMessage('theorem-message', 'Error adding theorem: ' + error.message, true);
            }
        });

        document.getElementById('definition-form-inner').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('definition-name').value;
            const definition = document.getElementById('definition-text').value;

            try {
                const response = await fetch('/api/definitions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, definition })
                });

                if (response.ok) {
                    showMessage('definition-message', 'Definition added successfully!');
                    document.getElementById('definition-form-inner').reset();
                    loadDefinitions(1);
                } else {
                    const error = await response.json();
                    showMessage('definition-message', error.detail || 'Error adding definition', true);
                }
            } catch (error) {
                showMessage('definition-message', 'Error adding definition: ' + error.message, true);
            }
        });

        document.getElementById('theorem-search-form').addEventListener('submit', (e) => {
            e.preventDefault();
            state.theorems.query = document.getElementById('theorem-search').value.trim();
            loadTheorems(1);
        });
        document.getElementById('theorem-clear').addEventListener('click', () => {
            state.theorems.query = '';
            document.getElementById('theorem-search').value = '';
            loadTheorems(1);
        });

        document.getElementById('definition-search-form').addEventListener('submit', (e) => {
            e.preventDefault();
            state.definitions.query = document.getElementById('definition-search').value.trim();
            loadDefinitions(1);
        });
        document.getElementById('definition-clear').addEventListener('click', () => {
            state.definitions.query = '';
            document.getElementById('definition-search').value = '';
            loadDefinitions(1);
        });

        loadTheorems();
        loadDefinitions();
    </script>
</body>
</html>
